import streamlit as st
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.metrics.pairwise import cosine_similarity
from langdetect import detect
import numpy as np

# FAQ Data
faq_data = {
    "en": {
        "what is siut": "SIUT stands for Samarkand International University of Technology, a modern higher education institution in Uzbekistan.",
        "where is siut located": "SIUT is located in Samarkand, Uzbekistan.",
        "how do i apply to siut": "You can apply to SIUT through the official website by filling out the online application form.",
        "what are the admission requirements": "Admission requirements vary by program but generally include transcripts, English proficiency, and an entrance exam.",
        "what is the tuition fee": "Tuition fees depend on the program. Check the official SIUT website for current information.",
        "does siut provide dormitories": "Yes, SIUT offers student dormitories for both local and international students.",
        "does siut offer scholarships": "Yes, SIUT provides merit-based and need-based scholarships.",
        "what programs does siut offer": "SIUT offers programs in technology, engineering, computer science, and business.",
        "what language are courses taught in": "Most courses at SIUT are taught in English.",
        "how can i contact siut": "You can contact SIUT through the website or by emailing info@siut.uz."
    },
    "uz": {
        "siut nima": "SIUT ‚Äî bu Samarqand Xalqaro Texnologiya Universiteti, zamonaviy oliy o‚Äòquv yurti.",
        "siut qayerda joylashgan": "SIUT Samarqand shahrida joylashgan.",
        "siutga qanday ariza topshiraman": "Siz SIUTga rasmiy veb-sayti orqali ariza topshirishingiz mumkin.",
        "qabul qilish talablari qanday": "Qabul talablari dasturga qarab o‚Äòzgaradi, lekin odatda diplom, ingliz tili darajasi va test talab qilinadi.",
        "kontrakt summasi qancha": "To‚Äòlov miqdori dasturga qarab farq qiladi. Rasmiy saytdan tekshiring.",
        "yotoqxona mavjudmi": "Ha, SIUT talabalar uchun yotoqxonalar taqdim etadi.",
        "stipendiyalar bormi": "Ha, SIUT turli stipendiyalarni taklif qiladi.",
        "qanday dasturlar mavjud": "SIUTda texnologiya, muhandislik, IT va biznes sohalari bo‚Äòyicha dasturlar mavjud.",
        "darslar qaysi tilda o‚Äòtiladi": "Asosan barcha darslar ingliz tilida olib boriladi.",
        "siut bilan qanday bog‚Äòlansam bo‚Äòladi": "Siz SIUTga rasmiy sayti yoki info@siut.uz elektron pochtasi orqali bog‚Äòlanishingiz mumkin."
    },
    "ru": {
        "—á—Ç–æ —Ç–∞–∫–æ–µ siut": "SIUT ‚Äî —ç—Ç–æ –°–∞–º–∞—Ä–∫–∞–Ω–¥—Å–∫–∏–π –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É—á–µ–±–Ω–æ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ –≤ –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω–µ.",
        "–≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è siut": "SIUT –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –°–∞–º–∞—Ä–∫–∞–Ω–¥–µ, –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω.",
        "–∫–∞–∫ –ø–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –≤ siut": "–í—ã –º–æ–∂–µ—Ç–µ –ø–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç SIUT, –∑–∞–ø–æ–ª–Ω–∏–≤ –æ–Ω–ª–∞–π–Ω-—Ñ–æ—Ä–º—É.",
        "–∫–∞–∫–æ–≤—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–æ—Å—Ç—É–ø–∞—é—â–∏–º": "–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∑–∞–≤–∏—Å—è—Ç –æ—Ç –ø—Ä–æ–≥—Ä–∞–º–º—ã, –æ–±—ã—á–Ω–æ –Ω—É–∂–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç—ã, –∑–Ω–∞–Ω–∏–µ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ –∏ –≤—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã–π —ç–∫–∑–∞–º–µ–Ω.",
        "—Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –æ–±—É—á–µ–Ω–∏–µ": "–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–æ–≥—Ä–∞–º–º—ã. –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —É–∫–∞–∑–∞–Ω–∞ –Ω–∞ —Å–∞–π—Ç–µ.",
        "–µ—Å—Ç—å –ª–∏ –æ–±—â–µ–∂–∏—Ç–∏–µ": "–î–∞, SIUT –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ–±—â–µ–∂–∏—Ç–∏—è –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤.",
        "–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –ª–∏ —Å—Ç–∏–ø–µ–Ω–¥–∏–∏": "–î–∞, —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–µ –∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ø–µ–Ω–¥–∏–∏.",
        "–∫–∞–∫–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –¥–æ—Å—Ç—É–ø–Ω—ã": "–í SIUT –µ—Å—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—ã –ø–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º, –∏–Ω–∂–µ–Ω–µ—Ä–∏–∏, IT –∏ –±–∏–∑–Ω–µ—Å—É.",
        "–Ω–∞ –∫–∞–∫–æ–º —è–∑—ã–∫–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –∑–∞–Ω—è—Ç–∏—è": "–û—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ –æ–±—É—á–µ–Ω–∏—è ‚Äî –∞–Ω–≥–ª–∏–π—Å–∫–∏–π.",
        "–∫–∞–∫ —Å–≤—è–∑–∞—Ç—å—Å—è —Å siut": "–í—ã –º–æ–∂–µ—Ç–µ –Ω–∞–ø–∏—Å–∞—Ç—å –Ω–∞ –ø–æ—á—Ç—É info@siut.uz –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–æ—Ä–º—É –Ω–∞ —Å–∞–π—Ç–µ."
    }
}

# Chatbot response function
def get_chatbot_response(user_input):
    try:
        lang = detect(user_input)
    except:
        return "Sorry, I couldn't detect the language. Please try again."

    if lang not in faq_data:
        return "Sorry, I can only respond in English, Russian, or Uzbek."

    questions = list(faq_data[lang].keys())
    vectorizer = TfidfVectorizer()
    tfidf = vectorizer.fit_transform(questions)
    user_vec = vectorizer.transform([user_input.lower()])
    similarity = cosine_similarity(user_vec, tfidf)
    best_match_idx = np.argmax(similarity)
    confidence = similarity[0][best_match_idx]

    if confidence < 0.3:
        return "I'm not sure how to answer that. Please ask a different question."

    best_question = questions[best_match_idx]
    return faq_data[lang][best_question]

# Streamlit UI
st.set_page_config(page_title="SIUT Chatbot")
st.title("ü§ñ SIUT Multilingual Chatbot")
st.write("Ask me about admissions, programs, dorms, tuition, etc. (English, Uzbek, Russian supported)")

user_query = st.text_input("Your question")

if user_query:
    response = get_chatbot_response(user_query)
    st.markdown(f"**Bot:** {response}")
